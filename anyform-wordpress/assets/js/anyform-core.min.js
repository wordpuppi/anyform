var AnyformCore=(function(exports){'use strict';function b(t){return t==null?true:typeof t=="string"?t.trim()==="":Array.isArray(t)?t.length===0:typeof t=="object"?Object.keys(t).length===0:false}function v(t){if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="string"){let e=parseFloat(t);return isNaN(e)?null:e}return null}var Y=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,K=/^https?:\/\/[^\s]+$/,Q=/^[\d\s\-\(\)\+]+$/,Z=/^\d{4}-\d{2}-\d{2}$/,ee=/^\d{2}:\d{2}(:\d{2})?$/,te=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}(:\d{2})?/;function A(t){return typeof t!="string"||Y.test(t)?null:"Invalid email format"}function M(t){return typeof t!="string"||K.test(t)?null:"Invalid URL format"}function F(t){return typeof t!="string"?null:!Q.test(t)||(t.match(/\d/g)||[]).length<7?"Invalid phone number format":null}function I(t){return typeof t!="string"||Z.test(t)?null:"Invalid date format (YYYY-MM-DD)"}function T(t){return typeof t!="string"||ee.test(t)?null:"Invalid time format (HH:MM)"}function L(t){return typeof t!="string"||te.test(t)?null:"Invalid date and time format"}function q(t){if(t==null||t===""||typeof t=="number")return null;if(typeof t=="string"){let e=parseFloat(t);if(isNaN(e))return "Must be a number"}return null}function $(t,e,n){return typeof t!="string"?null:t.length<e?`${n} must be at least ${e} characters`:null}function C(t,e,n){return typeof t!="string"?null:t.length>e?`${n} must be at most ${e} characters`:null}function R(t,e,n,r){if(typeof t!="string")return null;try{if(!new RegExp(e).test(t))return n||`${r} does not match the required format`}catch{}return null}function H(t,e,n){let r=v(t);return r===null?null:r<e?`${n} must be at least ${e}`:null}function N(t,e,n){let r=v(t);return r===null?null:r>e?`${n} must be at most ${e}`:null}function k(t,e){return Array.isArray(t)&&t.length<e?`Select at least ${e} option${e===1?"":"s"}`:null}function w(t,e){return Array.isArray(t)&&t.length>e?`Select at most ${e} option${e===1?"":"s"}`:null}function S(t,e){let n=[],r=t.validation,i=t.label;if((r.required||t.required)&&b(e))return n.push(`${i} is required`),n;if(b(e))return n;switch(t.field_type){case "email":{let s=A(e);s&&n.push(s);break}case "url":{let s=M(e);s&&n.push(s);break}case "tel":{let s=F(e);s&&n.push(s);break}case "date":{let s=I(e);s&&n.push(s);break}case "time":{let s=T(e);s&&n.push(s);break}case "datetime":{let s=L(e);s&&n.push(s);break}case "number":case "range":case "rating":case "scale":case "nps":{let s=q(e);s&&n.push(s);break}}if(r.min_length!==void 0){let s=$(e,r.min_length,i);s&&n.push(s);}if(r.max_length!==void 0){let s=C(e,r.max_length,i);s&&n.push(s);}if(r.pattern!==void 0){let s=R(e,r.pattern,r.pattern_message,i);s&&n.push(s);}if(r.min_value!==void 0){let s=H(e,r.min_value,i);s&&n.push(s);}if(r.max_value!==void 0){let s=N(e,r.max_value,i);s&&n.push(s);}if(r.min_selections!==void 0){let s=k(e,r.min_selections);s&&n.push(s);}if(r.max_selections!==void 0){let s=w(e,r.max_selections);s&&n.push(s);}return n}function E(t){return t==null?true:typeof t=="string"?t==="":Array.isArray(t)?t.length===0:typeof t=="object"?Object.keys(t).length===0:false}function y(t){if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="string"){let e=parseFloat(t);return isNaN(e)?null:e}return null}function O(t){return typeof t=="string"?t:null}function m(t,e){if(t==null)return e==null;if(e==null)return  false;let n=y(t),r=y(e);if(n!==null&&r!==null)return Math.abs(n-r)<Number.EPSILON;let i=O(t),o=O(e);return i!==null&&o!==null?i===o:typeof t=="boolean"&&typeof e=="string"?t===true&&e==="true"||t===false&&e==="false":typeof t=="string"&&typeof e=="boolean"?t==="true"&&e===true||t==="false"&&e===false:typeof t=="boolean"&&typeof e=="boolean"?t===e:Array.isArray(t)&&Array.isArray(e)?t.length!==e.length?false:t.every((s,l)=>m(s,e[l])):JSON.stringify(t)===JSON.stringify(e)}function D(t,e,n){let r=y(e),i=y(n);if(r===null||i===null)return  false;switch(t){case "gt":return r>i;case "gte":return r>=i;case "lt":return r<i;case "lte":return r<=i}}function x(t,e){return typeof t=="string"&&typeof e=="string"?t.includes(e):Array.isArray(t)?t.some(n=>m(n,e)):false}function B(t,e){return Array.isArray(e)?e.some(n=>m(t,n)):false}function W(t,e){return typeof t=="string"&&typeof e=="string"?t.startsWith(e):false}function P(t,e){return typeof t=="string"&&typeof e=="string"?t.endsWith(e):false}function g(t,e){if(!t)return  true;if("and"in t)return t.and.every(s=>g(s,e));if("or"in t)return t.or.some(s=>g(s,e));let n=e[t.field],r=t.op,i=t.value,o=ne(r);switch(o){case "empty":return E(n);case "not_empty":return !E(n);case "eq":return m(n,i);case "neq":return !m(n,i);case "gt":case "gte":case "lt":case "lte":return D(o,n,i);case "contains":return x(n,i);case "not_contains":return !x(n,i);case "starts_with":return W(n,i);case "ends_with":return P(n,i);case "in":return B(n,i);default:return  false}}function ne(t){switch(t){case "ne":return "neq";case "is_empty":return "empty";case "is_not_empty":return "not_empty";default:return t}}var h=class{constructor(e){this._schema=e,this._values=new Map,this._errors=new Map,this._touched=new Set,this._currentStepIndex=0;for(let n of e.steps)for(let r of n.fields)r.default_value!==void 0&&this._values.set(r.name,r.default_value);}set_value(e,n){this._values.set(e,n),this._touched.has(e)&&this.validateFieldInternal(e);}get_value(e){return this._values.get(e)??null}get_values(){let e={};for(let[n,r]of this._values)e[n]=r;return e}mark_touched(e){this._touched.add(e),this.validateFieldInternal(e);}is_touched(e){return this._touched.has(e)}validate_field(e){return this.validateFieldInternal(e),this._errors.get(e)??[]}validate_step(e){let n={},r=this._schema.steps.find(i=>i.id===e);if(r)for(let i of r.fields){if(!this.isFieldVisibleInternal(i.name))continue;let o=this._values.get(i.name)??null,s=S(i,o);s.length>0?(n[i.name]=s,this._errors.set(i.name,s)):this._errors.delete(i.name);}return n}validate_all(){for(let n of this._schema.steps)if(this.isStepVisibleInternal(n.id))for(let r of n.fields)this.isFieldVisibleInternal(r.name)&&this.validateFieldInternal(r.name);let e={};for(let[n,r]of this._errors)e[n]=r;return e}is_valid(){if(this._errors.size===0)return  true;for(let e of this._errors.values())if(e.length>0)return  false;return  true}get_errors(e){return this._errors.get(e)??[]}get_all_errors(){let e={};for(let[n,r]of this._errors)e[n]=r;return e}visible_steps(){return this._schema.steps.filter(e=>this.isStepVisibleInternal(e.id))}visible_fields(e){let n=[],r=e?this._schema.steps.filter(i=>i.id===e):this._schema.steps;for(let i of r)if(this.isStepVisibleInternal(i.id))for(let o of i.fields)this.isFieldVisibleInternal(o.name)&&n.push(o);return n}is_step_visible(e){return this.isStepVisibleInternal(e)}is_field_visible(e){return this.isFieldVisibleInternal(e)}current_step(){let n=this.getVisibleStepIndices()[this._currentStepIndex];return n!==void 0?this._schema.steps[n]??null:null}current_step_index(){return this._currentStepIndex}next_step(){let e=this.getVisibleStepIndices();return this._currentStepIndex+1<e.length?(this._currentStepIndex+=1,true):false}prev_step(){return this._currentStepIndex>0?(this._currentStepIndex-=1,true):false}go_to_step(e){let n=this.getVisibleStepIndices();for(let r=0;r<n.length;r++){let i=n[r];if(this._schema.steps[i]?.id===e)return this._currentStepIndex=r,true}return  false}can_go_next(){let e=this.getVisibleStepIndices();return this._currentStepIndex+1<e.length}can_go_prev(){return this._currentStepIndex>0}progress(){let e=this.getVisibleStepIndices();return [this._currentStepIndex+1,e.length]}is_last_step(){let e=this.getVisibleStepIndices();return this._currentStepIndex+1>=e.length}slug(){return this._schema.slug}name(){return this._schema.name}schema(){return this._schema}action_url(){return this._schema.action_url??this._schema.settings.action_url??`/api/forms/${this._schema.slug}`}action_method(){return this._schema.action_method??this._schema.settings.method??"POST"}validateFieldInternal(e){for(let n of this._schema.steps)for(let r of n.fields)if(r.name===e){let i=this._values.get(e)??null,o=S(r,i);o.length===0?this._errors.delete(e):this._errors.set(e,o);return}}isStepVisibleInternal(e){let n=this._schema.steps.find(r=>r.id===e);return n?this.evaluateCondition(n.condition):false}isFieldVisibleInternal(e){for(let n of this._schema.steps)if(this.evaluateCondition(n.condition)){for(let r of n.fields)if(r.name===e)return this.evaluateCondition(r.condition)}return  false}getVisibleStepIndices(){return this._schema.steps.map((e,n)=>({step:e,i:n})).filter(({step:e})=>this.evaluateCondition(e.condition)).map(({i:e})=>e)}evaluateCondition(e){return e?g(e,this.get_values()):true}};function re(){document.querySelectorAll("[data-af-form]").forEach(e=>{let n=e.dataset.afForm;n&&U(e,n);});}function ie(t){let e=document.querySelector(`[data-af-form="${t}"]`);e&&U(e,t);}function U(t,e){let n=se(t,e),r=new h(n);oe(t,r),le(t,r),ae(t,r),z(t,r),console.log(`Anyform hydrated: ${e}`);}function se(t,e){let n=[];if(t.querySelectorAll("[data-af-step]").forEach((i,o)=>{let s=i.getAttribute("data-af-step-id")||`step-${o}`,l=i.querySelector(".af-step-title")?.textContent||`Step ${o+1}`,d=j(i.getAttribute("data-af-condition")),a=[];i.querySelectorAll("[data-af-field]").forEach((u,c)=>{let f=u.getAttribute("data-af-field")||"",_=X(u,f,c);_&&a.push(_);}),n.push({id:s,name:l,order:o,condition:d,fields:a});}),n.length===0){let i=[];t.querySelectorAll("[data-af-field]").forEach((s,l)=>{let d=s.getAttribute("data-af-field")||"",a=X(s,d,l);a&&i.push(a);}),n.push({id:"step-0",name:"Form",order:0,fields:i});}return {id:t.getAttribute("data-af-form-id")||e,name:t.getAttribute("data-af-form-name")||e,slug:e,action_url:t.action||void 0,action_method:t.method?.toUpperCase()||"POST",settings:{},steps:n}}function X(t,e,n){let r=t.querySelector("label")?.textContent?.replace(/\*$/,"").trim()||e,i=t.querySelector("input, select, textarea");if(!i)return null;let o=t.getAttribute("data-af-validation"),s=t.getAttribute("data-af-condition"),l=o?JSON.parse(o):{},d=j(s),a="text";if(i.tagName==="SELECT")a=i.multiple?"multi_select":"select";else if(i.tagName==="TEXTAREA")a="textarea";else if(i instanceof HTMLInputElement){let u=i.type.toLowerCase();u==="checkbox"?a="checkbox":u==="radio"?a="radio":a=u;}let p=[];return i.tagName==="SELECT"?Array.from(i.options).forEach((c,f)=>{c.value&&p.push({id:`${e}-opt-${f}`,label:c.text,value:c.value,order:f});}):a==="radio"&&t.querySelectorAll(`input[name="${e}"]`).forEach((c,f)=>{let _=c.parentElement?.textContent?.trim()||c.value;p.push({id:`${e}-opt-${f}`,label:_,value:c.value,order:f});}),{id:i.id||`field-${e}`,name:e,label:r,field_type:a,placeholder:"placeholder"in i&&i.placeholder||void 0,validation:l,condition:d,options:p,order:n,required:l.required||i.required}}function j(t){if(t)try{return JSON.parse(t)}catch{return}}function oe(t,e){t.querySelectorAll("input, select, textarea").forEach(r=>{let i=r.name;if(!i)return;let o=()=>{let l;r.type==="checkbox"?l=r.checked:r.type==="number"||r.type==="range"?l=r.value===""?"":parseFloat(r.value):r instanceof HTMLSelectElement&&r.multiple?l=Array.from(r.selectedOptions).map(d=>d.value):l=r.value,e.set_value(i,l),z(t,e),V(t,i,e);},s=()=>{e.mark_touched(i),V(t,i,e);};r.addEventListener("input",o),r.addEventListener("change",o),r.addEventListener("blur",s);});}function le(t,e){t.querySelectorAll(".af-next").forEach(i=>{i.addEventListener("click",o=>{o.preventDefault(),e.next_step()&&(J(t,e),G(t,e));});}),t.querySelectorAll(".af-prev").forEach(i=>{i.addEventListener("click",o=>{o.preventDefault(),e.prev_step()&&(J(t,e),G(t,e));});});}function ae(t,e){t.addEventListener("submit",n=>{let r=e.validate_all();if(Object.values(r).some(o=>o.length>0)){n.preventDefault(),e.visible_fields().forEach(s=>{e.mark_touched(s.name),V(t,s.name,e);});return}});}function z(t,e){J(t,e),t.querySelectorAll("[data-af-field]").forEach(r=>{let i=r.getAttribute("data-af-field");if(i){let o=e.is_field_visible(i);r.style.display=o?"":"none",r.setAttribute("data-af-visible",String(o));}});}function J(t,e){let n=e.current_step();t.querySelectorAll("[data-af-step]").forEach(l=>{let d=parseInt(l.getAttribute("data-af-step")||"0",10),a=e.visible_steps(),p=e.current_step_index(),u=a[p]?.id===l.getAttribute("data-af-step-id")||n&&d===e.current_step_index();l.style.display=u?"":"none",l.setAttribute("data-af-visible",String(u));});let i=t.querySelectorAll(".af-prev"),o=t.querySelectorAll(".af-next"),s=t.querySelectorAll(".af-submit");i.forEach(l=>{l.disabled=!e.can_go_prev();}),o.forEach(l=>{l.style.display=e.is_last_step()?"none":"";}),s.forEach(l=>{l.style.display=e.is_last_step()?"":"none";});}function G(t,e){let[n,r]=e.progress(),i=t.querySelector(".af-progress");if(i){let o=i.querySelector("progress");o&&(o.value=n,o.max=r);let s=i.querySelector(".af-progress-text");s&&(s.textContent=`Step ${n} of ${r}`);}}function V(t,e,n){let r=n.get_errors(e),i=n.is_touched(e),o=t.querySelector(`[data-af-field="${e}"]`);if(!o)return;let s=o.querySelector(".af-error-message");if(s||(s=document.createElement("div"),s.className="af-error-message",s.setAttribute("role","alert"),s.setAttribute("aria-live","polite"),s.id=`af-error-${e}`,o.appendChild(s)),i&&r.length>0){s.textContent=r[0],o.classList.add("af-error");let l=o.querySelector("input, select, textarea");l&&(l.setAttribute("aria-invalid","true"),l.setAttribute("aria-describedby",`af-error-${e}`));}else {s.textContent="",o.classList.remove("af-error");let l=o.querySelector("input, select, textarea");l&&(l.removeAttribute("aria-invalid"),l.removeAttribute("aria-describedby"));}}typeof window<"u"&&(window.AnyformCore={hydrateAll:re,hydrate:ie,FormState:h});exports.hydrate=ie;exports.hydrateAll=re;return exports;})({});//# sourceMappingURL=hydrate.global.js.map
//# sourceMappingURL=hydrate.global.js.map